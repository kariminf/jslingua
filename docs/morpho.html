<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Transliteration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="use/pure-min.css">
  <link rel="stylesheet" href="use/grids-responsive-min.css">
  <link rel="stylesheet" href="use/jslingua.css">

  <script src="w3.js"></script>
  <script type="text/javascript" src="call.js"></script>
  <script type="text/javascript">
  addScript("jslingua.min.js");
  addScript("morpho.min.js");
  addScript("ara.morpho.min.js");
  //addScript("jpn.morpho.min.js");
  addScript("eng.morpho.min.js");
  </script>

  <script type="text/javascript">
  var morpho = {};
  var $ = function(id){return document.getElementById(id)};
  var _ = function(e){return e.options[e.selectedIndex]};

  function loading(){
    var e = $("l");

    var langIDs = JsLingua.serviceLanguages("Morpho");
    var i;
    for (i = 0; i < langIDs.length; i++){
      var option = document.createElement("option");
      option.text = langIDs[i];
      e.add(option);
    }

    update();

  }

  function update(){
    var lang = _($("l")).text;
    morpho = new (JsLingua.getService("Morpho", lang))();
    $("verb").dir = JsLingua.getDir(lang);
    $("conj").dir = JsLingua.getDir(lang);
    $("stemI").dir = JsLingua.getDir(lang);
    $("stemO").dir = JsLingua.getDir(lang);

    var stemmers = morpho.availableStemmers();
    var m = $("stemM");
    var i = m.options.length;
    while (i--) m.remove(i);

    stemmers.forEach(function(element, index, array){
      var option = document.createElement("option");
      option.text = element;
      m.add(option);
    });

    setMethod();
  }

  function setMethod(){
    var sn = _($("stemM")).value;
    if (sn) morpho.setCurrentStemmer(sn);
  }

  function htmlEntities(str) {
    var result = String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;');
    result = result.replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/ /gi, "&nbsp;");
    return result;
  }

  function conjugate() {
    var verb = $("verb").value;
    var result = "<table border=\"1\">";

    //console.log(morpho.getPronounOpts());

    var tenses = morpho.getTenses();
    result += "<tr><th></th>";
    tenses.forEach(function(element, index, array){
      result += "<th>" + morpho.getTenseName(element) + "</th>";
    });
    result += "</tr>";

    morpho.getPronounOpts().forEach(function(pOpt, pIdx, pTab){
      result += "<tr>";
      result += "<th>" + morpho.getPronounName(pOpt) + "</th>";
      //create a new clone
      var allOpts = Object.assign({}, pOpt);
      tenses.forEach(function(tOpt, tIdx, tTab){
        allOpts.tense = tOpt;
        //console.log(tOpt);
        result += "<td>" + morpho.conjugate(verb, allOpts) + "</td>";
      });
      result += "</tr>";
    });

    result += "</table>"

    $("conj").innerHTML = result;
  }

  function stem(){
    $("stemO").innerHTML = morpho.stem($("stemI").value);
  }

  </script>

</head>
<body>

  <div w3-include-html="menu.html"></div>

  <div class="content-wrapper">

    <div class="content pure-g">

      <div class="pure-u-1">
        <div class="kfs" >
          <h1><span>Language</span></h1>
          <label>Choose the language:</label>
          <select id="l" class="k-select" onchange="update()">
          </select>
        </div>
      </div>

      <div class="pure-u-1">
        <div class="kfs" >
          <h1><span>Stemming</span></h1>
          <label>Method</label>
          <select id="stemM" class="k-select" onchange="setMethod()">
          </select>
          <input type="text" id="stemI" />
          <button onclick="stem()" class="pure-button-secondary pure-button">Conjugate</button><br>
          <div id="stemO" class="k-input pure-input-1" ></div>
        </div>
      </div>

      <div class="pure-u-1">
        <div class="kfs" >
          <h1><span>Verb Conjugation</span></h1>
          <label>The verb</label>
          <input type="text" id="verb" />
          <button onclick="conjugate()" class="pure-button-secondary pure-button">Conjugate</button><br>
          <div id="conj" class="k-input pure-input-1" ></div>
        </div>
      </div>

    </div>

    <div w3-include-html="footer.html"></div>

  </div>

  <script>
  w3.includeHTML();
  loading();
  </script>

</body>
</html>
